---
title: "NPM Prepare Script Pitfall"
---

Today I learned that if you run `npm publish` with sudo and have a prepare script that runs babel, that script will fail to actually run.

```
npm WARN lifecycle @erickmerchant/example@0.0.0~prepare: cannot run in wd %s %s (wd=%s) @erickmerchant/example@0.0.0 npm run build /Users/erickmerchant/Code/example
```

Your package will publish correctly, essentially publishing a broken version. In my case it just published the last code that was actually transpiled with `npm run prepare`. You should never `npm publish` with with sudo. You should also never really need to use sudo with npm.

- https://docs.npmjs.com/misc/scripts

  About scripts

- https://www.npmjs.com/package/np

  Highly recommended package to make publishing easier.

- https://docs.npmjs.com/getting-started/fixing-npm-permissions

  A useful video about fixing npm permissions
